<!doctype html>
<html>
  <head>
    <title>Hornse Survival</title>
    <style>
      body {
        background-color: rgb(50, 200, 30);
        margin: 0px;
        padding: 0px;
      }
      #canvas1 {
        display: block;
        position: absolute;
        top: 0px;
        left: 0px;
        z-index: -1;
        image-rendering: pixelated;
        background-color: rgb(50, 200, 30);
      }
    </style>
  </head>
  <body>
    <h1 id="test">// // //</h1>
    <canvas id="canvas1"></canvas>
    <img hidden id="player" src="images/bestHornse.png" />
    <img hidden id="miniMap" src="images/miniMap.png" />
  </body>
</html>

<script>
  //CANVAS STUFF
  const playerImage = document.getElementById("player");
  const miniMapImage = document.getElementById("miniMap");
  const testText = document.getElementById("test");
  const canvas = document.getElementById("canvas1");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  let playerState = "idle";
  let mapState = "center";
  let player = {
    x: 0,
    y: 0,
  };
  let accel = {
    x: 0,
    y: 0,
  };
  const accelCap = 0.75;
  const accelStep = 0.02;
  const friction = 0.005;

  let keysDown = {};

  function animate() {
    let gameFrame = 0;
    const staggerFrames = 20;
    const spriteAnimations = {
      //player
      idle: {
        loc: [{ x: 0, y: 0 }],
      },
      walk: {
        loc: [
          { x: 200, y: 0 },
          { x: 400, y: 0 },
        ],
      },
      //miniMap
      upLeft: {
        loc: [{ x: 0, y: 0 }],
      },
      upCenter: {
        loc: [{ x: 256, y: 0 }],
      },
      upRight: {
        loc: [{ x: 512, y: 0 }],
      },
      centerLeft: {
        loc: [{ x: 0, y: 256 }],
      },
      center: {
        loc: [{ x: 256, y: 256 }],
      },
      centerRight: {
        loc: [{ x: 512, y: 256 }],
      },
      bottomLeft: {
        loc: [{ x: 0, y: 512 }],
      },
      bottomCenter: {
        loc: [{ x: 256, y: 512 }],
      },
      bottomRight: {
        loc: [{ x: 512, y: 512 }],
      },
    };
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    let playerFrameX =
      (200 * Math.floor(gameFrame / staggerFrames)) %
      spriteAnimations[playerState].loc.length;
    let mapFrameX = 256;

    /*let playerFrameX = 0;
    if (playerState === "walk") {
      playerFrameX =
        (Math.floor(gameFrame / staggerFrames) %
          spriteAnimations[playerState].loc.length) *
          200 +
        1;
    } else if (playerState === "idle") {
      playerFrameX =
        (Math.floor(gameFrame / staggerFrames) %
          spriteAnimations[playerState].loc.length) *
        200;
    }*/
    //let mFrameX = playerFrameX;
    let mapFrameY = 0;
    // (image, sourceX, sourceY, sourceW, sourceH, displayX, displayY, displayW, displayH)
    ctx.drawImage(
      playerImage,
      playerFrameX,
      0,
      200,
      200,
      player.x,
      player.y,
      100,
      100,
    );
    ctx.drawImage(
      miniMapImage,
      mapFrameX,
      mapFrameY,
      256,
      256,
      canvas.width - 150,
      0,
      128,
      128,
    );
    gameFrame++;
    requestAnimationFrame(animate);
  }
  window.onload = animate();

  document.addEventListener("keydown", (e) => {
    if (!keysDown[e.code]) {
      keysDown[e.code] = true;
    }
  });

  document.addEventListener("keyup", (e) => {
    keysDown[e.code] = false;
  });

  function runTest(junk) {
    testText.innerText =
      Math.floor(player.x) +
      " : " +
      Math.floor(player.y) +
      " : " +
      accel.x +
      " : " +
      accel.y;
    +" : " + junk;
  }

  function movement() {
    //POSITION CHANGE
    player.x += accel.x;
    player.y += accel.y;
    //VELOCITY Y
    if (accel.y > -accelCap && accel.y < accelCap) {
      if (keysDown.KeyW) {
        accel.y += -accelStep;
      }
      if (keysDown.KeyS) {
        accel.y += accelStep;
      }
    } else {
      if (accel.y < accelCap) {
        accel.y = -accelCap;
      } else {
        accel.y = accelCap;
      }
      if (keysDown.KeyW) {
      }
      if (keysDown.KeyS) {
      }
    }
    //FRICTION Y
    if (
      (keysDown["KeyW"] && keysDown["KeyS"]) ||
      (!keysDown["KeyW"] && !keysDown["KeyS"])
    ) {
      if (Math.abs(accel.y) < 0.05) {
        accel.y = 0;
      } else if (accel.y > 0) {
        accel.y += -friction;
      } else if (accel.y < 0) {
        accel.y += friction;
      }
    }
    //VELOCITY X
    if (accel.x > -accelCap && accel.x < accelCap) {
      if (keysDown.KeyA) {
        accel.x += -accelStep;
      }
      if (keysDown.KeyD) {
        accel.x += accelStep;
      }
    } else {
      if (accel.x < accelCap) {
        accel.x = -accelCap;
      } else {
        accel.x = accelCap;
      }
      if (keysDown.KeyA) {
      }
      if (keysDown.KeyD) {
      }
    }
    //FRICTION X
    if (
      (keysDown["KeyA"] && keysDown["KeyD"]) ||
      (!keysDown["KeyA"] && !keysDown["KeyD"])
    ) {
      if (Math.abs(accel.x) < 0.05) {
        accel.x = 0;
      } else if (accel.x > 0) {
        accel.x += -friction;
      } else if (accel.x < 0) {
        accel.x += friction;
      }
    }
  }

  /*function movement(coord) {
    //POSITION CHANGE
    player.coord += accel.coord;
    //VELOCITY
    if (accel.coord > -accelCap && accel.coord < accelCap) {
      if (keysDown.KeyW) {
        accel.coord += -accelStep;
      }
      if (keysDown.KeyS) {
        accel.coord += accelStep;
      }
    } else {
      if (accel.coord < accelCap) {
        accel.coord = -accelCap;
      } else {
        accel.coord = accelCap;
      }
    }
    //FRICTION
    if (
      (keysDown["KeyW"] && keysDown["KeyS"]) ||
      (!keysDown["KeyW"] && !keysDown["KeyS"])
    ) {
      if (Math.abs(accel.coord) < 0.05) {
        accel.coord = 0;
      } else if (accel.coord > 0) {
        accel.coord += -friction;
      } else if (accel.coord < 0) {
        accel.coord += friction;
      }
    }
  }*/

  function main() {
    movement();
    if (Math.abs(accel.x) === 0 && Math.abs(accel.y) === 0) {
      playerState = "idle";
    } else {
      playerState = "walk";
    }
    runTest();
  }

  setInterval(() => {
    main();
  }, 1);
</script>
