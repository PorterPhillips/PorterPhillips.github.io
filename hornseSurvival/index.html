<!DOCTYPE html>
<html>
  <head>
    <title>Hornse Survival</title>
    <style>
      body {
        background-color: rgb(50, 200, 30);
        margin: 0px;
      }
      #canvas1 {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 600px;
        height: 600px;
        background-color: white;
      }
    </style>
  </head>
  <body>
    <h1 id="test">TEST//TEST//TEST</h1>
    <canvas id="canvas1"></canvas>
  </body>
</html>

<script>
  //CANVAS STUFF
  const canvas = document.getElementById("canvas1");
  const ctx = canvas.getContext("2d");
  const CANVAS_WIDTH = 600;
  const CANVAS_HEIGHT = 600;
  canvas.height = CANVAS_HEIGHT;
  canvas.width = CANVAS_WIDTH;

  const playerImage = new Image();
  playerImage.src = "Hornse_player.png";
  const spriteWidth = 50;
  const spriteHeight = 50;
  let playerState = "walk";

  let gameFrame = 0;
  const staggerFrames = 35;
  const spriteAnimations = [
    "idle" = {
      loc: [
        {x: 0, y: 0,}
      ]
    },
    "walk" = {
      loc: [
        {x: 50, y: 0,},
        {x: 100, y: 0,},
        {x: 150, y: 0,},
        {x: 200, y: 0,}
      ]
    }
  ];

  function animate() {
    ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
    let position = Math.floor(gameFrame / staggerFrames) % spriteAnimations[playerState].loc.length;
    let frameX = spriteWidth * position;
    let frameY = 0;
    // (image, sx, sy, sw, sh, dx, dy, dw, dh)
    ctx.drawImage(
      playerImage,
      frameX,
      0,
      spriteWidth,
      spriteHeight,
      0,
      0,
      spriteWidth,
      spriteHeight
    );
    gameFrame++;
    requestAnimationFrame(animate);
  }
  animate();

  //NOT CANVAS STUFF
  const getPlayer = document.getElementById("");
  const testText = document.getElementById("test");
  let keysDown = {};
  let player = {
    name: "player",
    x: 0,
    y: 0,
    accelX: 0,
    accelY: 0,
  };
  const accelMax = 2;
  const accelInc = 0.01;
  const friction = 0.02;

  function runTest() {
    testText.innerText =
      JSON.stringify(keysDown) + " : " + player.accelX + " : " + player.accelY;
  }

  //KEY UP AND KEY DOWN
  document.addEventListener("keydown", (e) => {
    if (!keysDown[e.code]) {
      keysDown[e.code] = true;
    }
    runTest();
    movementCalc();
    runTest();
  });
  document.addEventListener("keyup", (e) => {
    keysDown[e.code] = false;
    runTest();
    movementCalc();
    runTest();
  });

  function movementCalc() {
    //POSITION CHANGE
    //getPlayer.style.top = player.y + "px";
    //getPlayer.style.left = player.x + "px";
    player.x += player.accelX;
    player.y += player.accelY;
    //VELOCITY Y
    if (player.accelY > -accelMax && player.accelY < accelMax) {
      if (keysDown["KeyW"]) {
        player.accelY += -accelInc;
      }
      if (keysDown["KeyS"]) {
        player.accelY += accelInc;
      }
    } else {
      if (player.accelY < accelMax) {
        player.accelY = -accelMax;
      } else {
        player.accelY = accelMax;
      }
    }
    //FRICTION Y
    if (
      (keysDown["KeyW"] && keysDown["KeyS"]) ||
      (!keysDown["KeyW"] && !keysDown["KeyS"])
    ) {
      if (Math.abs(player.accelY < 0.1)) {
        player.accelY = 0;
      } else if (player.accelY > 0) {
        player.accelY += -friction;
      } else if (player.accelY < 0) {
        player.accelY += friction;
      }
    }
  }
  //VELOCITY X
  if (player.accelX > -accelMax && player.accelX < accelMax) {
    if (keysDown["KeyA"]) {
      player.accelX += -accelInc;
    }
    if (keysDown["KeyD"]) {
      player.accelX += accelInc;
    }
  } else {
    if (player.accelX < accelMax) {
      player.accelX = -accelMax;
    } else {
      player.accelX = accelMax;
    }
  }
  //FRICTION X
  if (
    (keysDown["KeyA"] && keysDown["KeyD"]) ||
    (!keysDown["KeyA"] && !keysDown["KeyD"])
  ) {
    if (Math.abs(player.accelX < 0.1)) {
      player.accelX = 0;
    } else if (player.accelX > 0) {
      player.accelX += -friction;
    } else if (player.accelX < 0) {
      player.accelX += friction;
    }
  }

  setInterval(() => {
    movementCalc();
    runTest();
  }, 1);
</script>
